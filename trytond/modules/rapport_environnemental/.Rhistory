source('~/tryton283/trytond/trytond/modules/rapport_environnemental/bef.R')
source('~/tryton283/trytond/trytond/modules/rapport_environnemental/bef.R')
source('~/tryton283/trytond/trytond/modules/rapport_environnemental/bef.R')
source('~/tryton283/trytond/trytond/modules/rapport_environnemental/bef.R')
source('~/tryton283/trytond/trytond/modules/rapport_environnemental/bef.R')
source('~/tryton283/trytond/trytond/modules/rapport_environnemental/bef.R')
source('~/tryton283/trytond/trytond/modules/rapport_environnemental/bef.R')
library(RPostgreSQL)
library(RgoogleMaps)
library(PBSmapping)
library(dismo)
library(odfWeave)
library(ggplot2)
options(width = 50)
drv <- dbDriver("PostgreSQL")
con <- dbConnect(drv, dbname="bef28", user="pascal", password="Pobf6332!", host="localhost", port="5432")
party <- dbReadTable(con, "party_party")
protection <- dbReadTable(con, "protection_area")
rs <- dbSendQuery(con, "SELECT DISTINCT a.id as ID, a.name AS tiers,
ST_X(ST_Transform(ST_Centroid(a.geom),4326)) AS TX93, ST_Y(ST_Transform(ST_Centroid(a.geom),4326)) AS TY93,
sta.typo AS type, sta.espace as statut, sta.name AS nom,
to_char(ST_Distance(a.geom, sta.geom)/1000,'0.999 km') AS distance,
ST_Distance(a.geom, sta.geom)/1000 AS km,
ST_X(ST_Transform(ST_Centroid(sta.geom),4326)) AS X93, ST_Y(ST_Transform(ST_Centroid(sta.geom),4326)) AS Y93,
st_area(ST_Intersection(ST_Buffer(a.geom,500),sta.geom))/10000 AS surface500,
st_area(ST_Intersection(ST_Buffer(a.geom,2000),sta.geom))/10000 AS surface2000,
st_area(ST_Intersection(ST_Buffer(a.geom,5000),sta.geom))/10000 AS surface5000
FROM place_place a, protection_area sta
WHERE ST_Distance(a.geom, sta.geom) <= 5000
ORDER BY tiers, type, statut, distance;")
df <- fetch(rs,n=-1)
dbDisconnect(con)
rm(con,drv)
dff <- subset(df, select=c(2,5:9))
save(party,protection,df, file="/home/pascal/TablesBrutesBEF.RData")
load("/home/pascal/TablesBrutesBEF.RData")
lat <- df$ty93[1]
lon <- df$tx93[1]
center = c(lat, lon)
marker <- paste("&markers=color:blue|label:I|", lat, sep="")
marker <- paste(marker, lon, sep=",")
France <- GetMap(center=center, zoom=5, markers = marker, destfile = #"/home/pascal/france1.png", maptype="hybrid")
png("/home/pascal/france2.png", 640, 640)
plot.new()
PlotOnStaticMap(France, center=center, add = F)
text(lat,lon,df$tiers[1])
dev.off()
MyMap <- GetMap(center=center, zoom=12, markers = marker, destfile = #"/home/pascal/MyTile.png", maptype="hybrid")
protection <- importShapefile("/home/pascal/protection84.shp")
tampon500 <- importShapefile("/home/pascal/tampon500WGS84.shp")
tampon2000 <- importShapefile("/home/pascal/tampon2000WGS84.shp")
tampon5000 <- importShapefile("/home/pascal/tampon5000WGS84.shp")
png("/home/pascal/Bio Eco Forests.png",640,640)
plot.new()
PlotPolysOnStaticMap(MyMap, protection, lwd=.5, col = rgb(1,1,1,0.4), add = F)
PlotPolysOnStaticMap(MyMap, tampon5000, lwd=.5, col = rgb(1,0,0,0.1), add = T)
PlotPolysOnStaticMap(MyMap, tampon2000, lwd=.5, col = rgb(1,0,0,0.2), add = T)
PlotPolysOnStaticMap(MyMap, tampon500, lwd=.5, col = rgb(1,0,0,0.3), add = T)
text(lat,lon,df$tiers[1])
legend("topright", c("Protection","Buffer 500m","Buffer 2000m","Buffer 5000m"), fill = #c(rgb(1,1,1,0.4),rgb(1,0,0,0.1),rgb(1,0,0,0.2),rgb(1,0,0,0.3) ), title="Légende")
dev.off()
load("/home/pascal/TablesBrutesBEF.RData")
lat <- df$ty93[1]
lon <- df$tx93[1]
center = c(lat, lon)
marker <- paste("&markers=color:blue|label:I|", lat, sep="")
marker <- paste(marker, lon, sep=",")
France <- GetMap(center=center, zoom=5, markers = marker, destfile = #"/home/pascal/france1.png", maptype="hybrid")
png("/home/pascal/france2.png", 640, 640)
plot.new()
PlotOnStaticMap(France, center=center, add = F)
text(lat,lon,df$tiers[1])
dev.off()
France <- GetMap(center=center, zoom=5, markers = marker, destfile = "/home/pascal/france1.png", maptype="hybrid")
load("/home/pascal/TablesBrutesBEF.RData")
lat <- df$ty93[1]
lon <- df$tx93[1]
center = c(lat, lon)
marker <- paste("&markers=color:blue|label:I|", lat, sep="")
marker <- paste(marker, lon, sep=",")
France <- GetMap(center=center, zoom=5, markers = marker, destfile = "/home/pascal/france1.png", maptype="hybrid")
png("/home/pascal/france2.png", 640, 640)
plot.new()
PlotOnStaticMap(France, center=center, add = F)
text(lat,lon,df$tiers[1])
dev.off()
MyMap <- GetMap(center=center, zoom=12, markers = marker, destfile = "/home/pascal/MyTile.png", maptype="hybrid")
protection <- importShapefile("/home/pascal/protection84.shp")
protection <- importShapefile("/home/pascal/protection84.shp")
tampon500 <- importShapefile("/home/pascal/tampon500WGS84.shp")
tampon2000 <- importShapefile("/home/pascal/tampon2000WGS84.shp")
tampon5000 <- importShapefile("/home/pascal/tampon5000WGS84.shp")
png("/home/pascal/Bio Eco Forests.png",640,640)
plot.new()
PlotPolysOnStaticMap(MyMap, protection, lwd=.5, col = rgb(1,1,1,0.4), add = F)
PlotPolysOnStaticMap(MyMap, tampon5000, lwd=.5, col = rgb(1,0,0,0.1), add = T)
PlotPolysOnStaticMap(MyMap, tampon2000, lwd=.5, col = rgb(1,0,0,0.2), add = T)
PlotPolysOnStaticMap(MyMap, tampon500, lwd=.5, col = rgb(1,0,0,0.3), add = T)
text(lat,lon,df$tiers[1])
legend("topright", c("Protection","Buffer 500m","Buffer 2000m","Buffer 5000m"), fill = #c(rgb(1,1,1,0.4),rgb(1,0,0,0.1),rgb(1,0,0,0.2),rgb(1,0,0,0.3) ), title="Légende")
legend("topright", c("Protection","Buffer 500m","Buffer 2000m","Buffer 5000m"), fill = c(rgb(1,1,1,0.4),rgb(1,0,0,0.1),rgb(1,0,0,0.2),rgb(1,0,0,0.3) ), title="Légende")
dev.off()
MyMap <- GetMap(center=center, zoom=12, markers = marker, destfile = "/home/pascal/MyTile.png", maptype="hybrid")
protection <- importShapefile("/home/pascal/protection84.shp")
tampon500 <- importShapefile("/home/pascal/tampon500WGS84.shp")
tampon2000 <- importShapefile("/home/pascal/tampon2000WGS84.shp")
tampon5000 <- importShapefile("/home/pascal/tampon5000WGS84.shp")
png("/home/pascal/Bio Eco Forests.png",640,640)
plot.new()
PlotPolysOnStaticMap(MyMap, protection, lwd=.5, col = rgb(1,1,1,0.4), add = F)
PlotPolysOnStaticMap(MyMap, tampon5000, lwd=.5, col = rgb(1,0,0,0.1), add = T)
PlotPolysOnStaticMap(MyMap, tampon2000, lwd=.5, col = rgb(1,0,0,0.2), add = T)
PlotPolysOnStaticMap(MyMap, tampon500, lwd=.5, col = rgb(1,0,0,0.3), add = T)
text(lat,lon,df$tiers[1])
legend("topright", c("Protection","Buffer 500m","Buffer 2000m","Buffer 5000m"), fill = c(rgb(1,1,1,0.4),rgb(1,0,0,0.1),rgb(1,0,0,0.2),rgb(1,0,0,0.3) ), title="Légende")
dev.off()
MyMap <- GetMap(center=center, zoom=12, markers = marker, destfile = "/home/pascal/MyTile.png", maptype="hybrid")
protection <- importShapefile("/home/pascal/protection84.shp")
tampon500 <- importShapefile("/home/pascal/tampon500WGS84.shp")
tampon2000 <- importShapefile("/home/pascal/tampon2000WGS84.shp")
tampon5000 <- importShapefile("/home/pascal/tampon5000WGS84.shp")
png("/home/pascal/Bio Eco Forests.png",640,640)
plot.new()
PlotPolysOnStaticMap(MyMap, protection, lwd=.5, col = rgb(1,1,1,0.4), add = F)
PlotPolysOnStaticMap(MyMap, tampon5000, lwd=.5, col = rgb(1,0,0,0.1), add = T)
PlotPolysOnStaticMap(MyMap, tampon2000, lwd=.5, col = rgb(1,0,0,0.2), add = T)
PlotPolysOnStaticMap(MyMap, tampon500, lwd=.5, col = rgb(1,0,0,0.3), add = T)
text(lat,lon,df$tiers[1])
legend("topright", c("Protection","Buffer 500m","Buffer 2000m","Buffer 5000m"), fill = c(rgb(1,1,1,0.4),rgb(1,0,0,0.1),rgb(1,0,0,0.2),rgb(1,0,0,0.3) ), title="Légende")
dev.off()
MyMap <- GetMap(center=center, zoom=12, markers = marker, destfile = "/home/pascal/MyTile.png", maptype="hybrid")
protection <- importShapefile("/home/pascal/protection84.shp")
tampon500 <- importShapefile("/home/pascal/tampon500WGS84.shp")
tampon2000 <- importShapefile("/home/pascal/tampon2000WGS84.shp")
tampon5000 <- importShapefile("/home/pascal/tampon5000WGS84.shp")
png("/home/pascal/Bio Eco Forests.png",640,640)
plot.new()
PlotPolysOnStaticMap(MyMap, protection, lwd=.5, col = rgb(1,1,1,0.4), add = F)
PlotPolysOnStaticMap(MyMap, tampon5000, lwd=.5, col = rgb(1,0,0,0.1), add = T)
PlotPolysOnStaticMap(MyMap, tampon2000, lwd=.5, col = rgb(1,0,0,0.2), add = T)
PlotPolysOnStaticMap(MyMap, tampon500, lwd=.5, col = rgb(1,0,0,0.3), add = T)
text(lat,lon,df$tiers[1])
legend("topright", c("Protection","Buffer 500m","Buffer 2000m","Buffer 5000m"), fill = c(rgb(1,1,1,0.4),rgb(1,0,0,0.1),rgb(1,0,0,0.2),rgb(1,0,0,0.3) ), title="Légende")
dev.off()
protection <- importShapefile("/home/pascal/protection84.shp")
tampon500 <- importShapefile("/home/pascal/tampon500WGS84.shp")
protection <- importShapefile("/home/pascal/protection84.shp")
tampon500 <- importShapefile("/home/pascal/tampon500WGS84.shp")
tampon2000 <- importShapefile("/home/pascal/tampon2000WGS84.shp")
tampon5000 <- importShapefile("/home/pascal/tampon5000WGS84.shp")
png("/home/pascal/Bio Eco Forests.png",640,640)
plot.new()
PlotPolysOnStaticMap(MyMap, protection, lwd=.5, col = rgb(1,1,1,0.4), add = F)
PlotPolysOnStaticMap(MyMap, tampon5000, lwd=.5, col = rgb(1,0,0,0.1), add = T)
PlotPolysOnStaticMap(MyMap, tampon2000, lwd=.5, col = rgb(1,0,0,0.2), add = T)
PlotPolysOnStaticMap(MyMap, tampon500, lwd=.5, col = rgb(1,0,0,0.3), add = T)
text(lat,lon,df$tiers[1])
legend("topright", c("Protection","Buffer 500m","Buffer 2000m","Buffer 5000m"), fill = c(rgb(1,1,1,0.4),rgb(1,0,0,0.1),rgb(1,0,0,0.2),rgb(1,0,0,0.3) ), title="Légende")
dev.off()
MyMap <- GetMap(center=center, zoom=12, markers = marker, destfile = "/home/pascal/MyTile.png", maptype="hybrid")
protection <- importShapefile("/home/pascal/protection84.shp")
tampon500 <- importShapefile("/home/pascal/tampon500WGS84.shp")
tampon2000 <- importShapefile("/home/pascal/tampon2000WGS84.shp")
tampon5000 <- importShapefile("/home/pascal/tampon5000WGS84.shp")
png("/home/pascal/Bio Eco Forests.png",640,640)
plot.new()
PlotPolysOnStaticMap(MyMap, protection, lwd=.5, col = rgb(1,1,1,0.4), add = F)
PlotPolysOnStaticMap(MyMap, tampon5000, lwd=.5, col = rgb(1,0,0,0.1), add = T)
PlotPolysOnStaticMap(MyMap, tampon2000, lwd=.5, col = rgb(1,0,0,0.2), add = T)
PlotPolysOnStaticMap(MyMap, tampon500, lwd=.5, col = rgb(1,0,0,0.3), add = T)
text(lat,lon,df$tiers[1])
legend("topright", c("Protection","Buffer 500m","Buffer 2000m","Buffer 5000m"), fill = c(rgb(1,1,1,0.4),rgb(1,0,0,0.1),rgb(1,0,0,0.2),rgb(1,0,0,0.3) ), title="Légende")
dev.off()
protection <- importShapefile("/home/pascal/protection84.shp")
tampon500 <- importShapefile("/home/pascal/tampon500WGS84.shp")
tampon2000 <- importShapefile("/home/pascal/tampon2000WGS84.shp")
tampon5000 <- importShapefile("/home/pascal/tampon5000WGS84.shp")
png("/home/pascal/Bio Eco Forests.png",640,640)
MyMap <- GetMap(center=center, zoom=12, markers = marker, destfile = "/home/pascal/MyTile.png", maptype="hybrid")
protection <- importShapefile("/home/pascal/protection84.shp")
tampon500 <- importShapefile("/home/pascal/tampon500WGS84.shp")
tampon2000 <- importShapefile("/home/pascal/tampon2000WGS84.shp")
tampon5000 <- importShapefile("/home/pascal/tampon5000WGS84.shp")
png("/home/pascal/Bio Eco Forests.png",640,640)
plot.new()
PlotPolysOnStaticMap(MyMap, protection, lwd=.5, col = rgb(1,1,1,0.4), add = F)
PlotPolysOnStaticMap(MyMap, tampon5000, lwd=.5, col = rgb(1,0,0,0.1), add = T)
PlotPolysOnStaticMap(MyMap, tampon2000, lwd=.5, col = rgb(1,0,0,0.2), add = T)
PlotPolysOnStaticMap(MyMap, tampon500, lwd=.5, col = rgb(1,0,0,0.3), add = T)
text(lat,lon,df$tiers[1])
legend("topright", c("Protection","Buffer 500m","Buffer 2000m","Buffer 5000m"), fill = c(rgb(1,1,1,0.4),rgb(1,0,0,0.1),rgb(1,0,0,0.2),rgb(1,0,0,0.3) ), title="Légende")
dev.off()
MyMap <- GetMap(center=center, zoom=12, markers = marker, destfile = "/home/pascal/MyTile.png", maptype="hybrid")
protection <- importShapefile("/home/pascal/protection84.shp")
tampon500 <- importShapefile("/home/pascal/tampon500WGS84.shp")
tampon2000 <- importShapefile("/home/pascal/tampon2000WGS84.shp")
tampon5000 <- importShapefile("/home/pascal/tampon5000WGS84.shp")
png("/home/pascal/Bio Eco Forests.png",640,640)
plot.new()
PlotPolysOnStaticMap(MyMap, protection, lwd=.5, col = rgb(1,1,1,0.4), add = F)
PlotPolysOnStaticMap(MyMap, tampon5000, lwd=.5, col = rgb(1,0,0,0.1), add = T)
PlotPolysOnStaticMap(MyMap, tampon2000, lwd=.5, col = rgb(1,0,0,0.2), add = T)
PlotPolysOnStaticMap(MyMap, tampon500, lwd=.5, col = rgb(1,0,0,0.3), add = T)
text(lat,lon,df$tiers[1])
legend("topright", c("Protection","Buffer 500m","Buffer 2000m","Buffer 5000m"), fill = c(rgb(1,1,1,0.4),rgb(1,0,0,0.1),rgb(1,0,0,0.2),rgb(1,0,0,0.3) ), title="Légende")
de
MyMap <- GetMap(center=center, zoom=12, markers = marker, destfile = "/home/pascal/MyTile.png", maptype="hybrid")
protection <- importShapefile("/home/pascal/protection84.shp")
tampon500 <- importShapefile("/home/pascal/tampon500WGS84.shp")
tampon2000 <- importShapefile("/home/pascal/tampon2000WGS84.shp")
tampon5000 <- importShapefile("/home/pascal/tampon5000WGS84.shp")
png("/home/pascal/Bio Eco Forests.png",640,640)
plot.new()
PlotPolysOnStaticMap(MyMap, protection, lwd=.5, col = rgb(1,1,1,0.4), add = F)
PlotPolysOnStaticMap(MyMap, tampon5000, lwd=.5, col = rgb(1,0,0,0.1), add = T)
MyMap <- GetMap(center=center, zoom=12, markers = marker, destfile = "/home/pascal/MyTile.png", maptype="hybrid")
protection <- importShapefile("/home/pascal/protection84.shp")
tampon500 <- importShapefile("/home/pascal/tampon500.shp")
tampon2000 <- importShapefile("/home/pascal/tampon2000.shp")
tampon5000 <- importShapefile("/home/pascal/tampon5000.shp")
png("/home/pascal/Bio Eco Forests.png",640,640)
plot.new()
PlotPolysOnStaticMap(MyMap, protection, lwd=.5, col = rgb(1,1,1,0.4), add = F)
PlotPolysOnStaticMap(MyMap, tampon5000, lwd=.5, col = rgb(1,0,0,0.1), add = T)
PlotPolysOnStaticMap(MyMap, tampon2000, lwd=.5, col = rgb(1,0,0,0.2), add = T)
PlotPolysOnStaticMap(MyMap, tampon500, lwd=.5, col = rgb(1,0,0,0.3), add = T)
text(lat,lon,df$tiers[1])
legend("topright", c("Protection","Buffer 500m","Buffer 2000m","Buffer 5000m"), fill = c(rgb(1,1,1,0.4),rgb(1,0,0,0.1),rgb(1,0,0,0.2),rgb(1,0,0,0.3) ), title="Légende")
dev.off()
odfWeave("/home/pascal/Bureau/bef.odt", "/home/pascal/Bureau/bef_out.odt")
France <- GetMap(center=center, zoom=5, markers = marker, destfile = "/home/pascal/france1.png", maptype="hybrid")
png("/home/pascal/france_bef.png", 640, 640)
plot.new()
PlotOnStaticMap(France, center=center, add = F)
text(lat,lon,df$tiers[1])
dev.off()
source('~/tryton283/trytond/trytond/modules/rapport_environnemental/bef.R')
install.packages("reshape2")
library("reshape2", lib.loc="/home/pascal/R/x86_64-pc-linux-gnu-library/3.0")
source('~/tryton283/trytond/trytond/modules/rapport_environnemental/bef.R')
clear
source('~/tryton283/trytond/trytond/modules/rapport_environnemental/bef.R')
makePlot <- function(){
Data <- data.frame(df[2:3,c(7,12:14)])
Data.melt <- melt(Data)
p <- ggplot(data=Data.melt,aes(x=factor(nom),fill=variable))
g <- p + geom_bar(aes(weight=value)) + xlab(" ") + ylab(" ")+ scale_fill_manual("variable",value=c("dodgerblue4","deepskyblue2","lightblue"))+ theme_bw()+coord_flip()
print(g)
}
Data <- data.frame(df[2:3,c(7,12:14)])
Data.melt <- melt(Data)
p <- ggplot(data=Data.melt,aes(x=factor(nom),fill=variable))
g <- p + geom_bar(aes(weight=value)) + xlab(" ") + ylab(" ")+ scale_fill_manual("variable",value=c("dodgerblue4","deepskyblue2","lightblue"))+ theme_bw()+coord_flip()
print(g)
View(Data)
View(Data.melt)
Data <- data.frame(df[2:3,c(7,12:14)])
Data.melt <- melt(Data)
p <- ggplot(data=Data.melt,aes(x=factor(nom),fill=variable))
g <- p + geom_bar(aes(weight=value)) + xlab(" ") + ylab(" ")+ scale_fill_manual("variable",value=c("dodgerblue4","deepskyblue2","lightblue"))+ theme_bw()+coord_flip()
print(g)
p <- ggplot(data=Data.melt,aes(x=factor(nom),fill=variable))
print(g)
ggplot(data=Data.melt,aes(x=factor(nom),fill=variable))
Data <- data.frame(df[2:3,c(7,12:14)])
Data.melt <- melt(Data)
ggplot(data=Data.melt,aes(x=factor(nom),fill=variable))
ggplot(data=Data,aes(x=factor(nom),fill=variable))
Data <- data.frame(df[2:3,c(7,12:14)])
Data.melt <- melt(Data)
ggplot(data=Data,aes(x=factor(nom),fill=variable))
plot(g)
g <- p + geom_bar(aes(weight=value)) + xlab(" ") + ylab(" ")+ scale_fill_manual("variable",value=c("dodgerblue4","deepskyblue2","lightblue"))+ theme_bw()+coord_flip()
Data <- data.frame(df[2:3,c(7,12:14)])
Data.melt <- melt(Data)
ggplot(data=Data.melt,aes(x=factor(nom),fill=variable))
g <- p + geom_bar(aes(weight=value)) + xlab(" ") + ylab(" ") + scale_fill_manual("variable",value=c("dodgerblue4","deepskyblue2","lightblue"))
+ theme_bw() + coord_flip()
g <- p + geom_bar(aes(weight=value)) + xlab(" ") + ylab(" ") #+ scale_fill_manual("variable",value=c("dodgerblue4","deepskyblue2","lightblue"))
+ theme_bw() + coord_flip()
Data <- data.frame(df[2:3,c(7,12:14)])
Data.melt <- melt(Data)
ggplot(data=Data.melt,aes(x=factor(nom),fill=variable))
g <- p + geom_bar(aes(weight=value)) + xlab(" ") + ylab(" ") #+ scale_fill_manual("variable",value=c("dodgerblue4","deepskyblue2","lightblue"))
#+ theme_bw() + coord_flip()
print(g)
plot(g)
Data <- data.frame(df[2:3,c(7,12:14)])
Data.melt <- melt(Data)
ggplot(data=Data.melt,aes(x=factor(nom),fill=variable))
g <- p + geom_bar(aes(weight=value)) + xlab(" ") + ylab(" ") #+ scale_fill_manual("variable",value=c("dodgerblue4","deepskyblue2","lightblue"))
#+ theme_bw()
+ coord_flip()
print(g)
source('~/.active-rstudio-document')
source('~/.active-rstudio-document')
source('~/.active-rstudio-document')
source('~/.active-rstudio-document')
source('~/.active-rstudio-document')
source('~/.active-rstudio-document')
source('~/.active-rstudio-document')
source('~/.active-rstudio-document')
source('~/.active-rstudio-document')
source('~/.active-rstudio-document')
source('~/.active-rstudio-document')
source('~/.active-rstudio-document')
source('~/.active-rstudio-document')
source('~/.active-rstudio-document')
source('~/.active-rstudio-document')
source('~/.active-rstudio-document')
source('~/tryton283/trytond/trytond/modules/rapport_environnemental/bef.R')
source('~/.active-rstudio-document')
source('~/.active-rstudio-document')
source('~/.active-rstudio-document')
source('~/tryton283/trytond/trytond/modules/rapport_environnemental/bef.R')
source('~/tryton283/trytond/trytond/modules/rapport_environnemental/bef.R')
library(RPostgreSQL)
library(RgoogleMaps)
library(PBSmapping)
library(dismo)
library(odfWeave)
library(ggplot2)
options(width = 50)
drv <- dbDriver("PostgreSQL")
con <- dbConnect(drv, dbname="bef28", user="pascal", password="Pobf6332!", host="localhost", port="5432")
party <- dbReadTable(con, "party_party")
protection <- dbReadTable(con, "protection_area")
rs <- dbSendQuery(con, "SELECT DISTINCT a.id as ID, a.name AS tiers,
ST_X(ST_Transform(ST_Centroid(a.geom),4326)) AS TX93, ST_Y(ST_Transform(ST_Centroid(a.geom),4326)) AS TY93,
sta.typo AS type, sta.espace as statut, sta.name AS nom,
to_char(ST_Distance(a.geom, sta.geom)/1000,'0.999 km') AS distance,
ST_Distance(a.geom, sta.geom)/1000 AS km,
ST_X(ST_Transform(ST_Centroid(sta.geom),4326)) AS X93, ST_Y(ST_Transform(ST_Centroid(sta.geom),4326)) AS Y93,
st_area(ST_Intersection(ST_Buffer(a.geom,500),sta.geom))/10000 AS surface500,
st_area(ST_Intersection(ST_Buffer(a.geom,2000),sta.geom))/10000 AS surface2000,
st_area(ST_Intersection(ST_Buffer(a.geom,5000),sta.geom))/10000 AS surface5000,
st_area(ST_Intersection(ST_Buffer(a.geom,10000),sta.geom))/10000 AS surface10000
FROM place_place a, protection_area sta
WHERE ST_Distance(a.geom, sta.geom) <= 10000
ORDER BY tiers, type, statut, distance;")
df <- fetch(rs,n=-1)
dbDisconnect(con)
rm(con,drv)
dff <- subset(df, select=c(2,5:9))
save(party,protection,df, file="/home/pascal/TablesBrutesBEF.RData")
load("/home/pascal/TablesBrutesBEF.RData")
lat <- df$ty93[1]
lon <- df$tx93[1]
center = c(lat, lon)
marker <- paste("&markers=color:blue|label:I|", lat, sep="")
marker <- paste(marker, lon, sep=",")
France <- GetMap(center=center, zoom=5, markers = marker, destfile = #"/home/pascal/france1.png", maptype="hybrid")
png("/home/pascal/france_bef.png", 640, 640)
plot.new()
PlotOnStaticMap(France, center=center, add = F)
text(lat,lon,df$tiers[1])
dev.off()
marker <- paste("&markers=color:blue|label:I|", lat, sep="")
marker <- paste(marker, lon, sep=",")
France <- GetMap(center=center, zoom=5, markers = marker, destfile = "/home/pascal/france1.png", maptype="hybrid")
png("/home/pascal/france_bef.png", 640, 640)
plot.new()
PlotOnStaticMap(France, center=center, add = F)
text(lat,lon,df$tiers[1])
dev.off()
MyMap <- GetMap(center=center, zoom=12, markers = marker, destfile = "/home/pascal/MyTile.png", maptype="hybrid")
protection <- importShapefile("/home/pascal/protection84.shp")
tampon500 <- importShapefile("/home/pascal/tampon500.shp")
tampon2000 <- importShapefile("/home/pascal/tampon2000.shp")
tampon5000 <- importShapefile("/home/pascal/tampon5000.shp")
tampon10000 <- importShapefile("/home/pascal/tampon10000.shp")
png("/home/pascal/Bio Eco Forests.png",640,640)
plot.new()
PlotPolysOnStaticMap(MyMap, protection, lwd=.5, col = rgb(1,1,1,0.4), add = F)
PlotPolysOnStaticMap(MyMap, tampon10000, lwd=.5, col = rgb(1,0,0,0.1), add = T)
PlotPolysOnStaticMap(MyMap, tampon5000, lwd=.5, col = rgb(1,0,0,0.2), add = T)
PlotPolysOnStaticMap(MyMap, tampon2000, lwd=.5, col = rgb(1,0,0,0.3), add = T)
PlotPolysOnStaticMap(MyMap, tampon500, lwd=.5, col = rgb(1,0,0,0.4), add = T)
text(lat,lon,df$tiers[1])
legend("topright", c("Protection","Buffer 500m","Buffer 2000m","Buffer 5000m","Buffer 10000m"), fill = c(rgb(1,1,1,0.4),rgb(1,0,0,0.1),rgb(1,0,0,0.2),rgb(1,0,0,0.3),rgb(1,0,0,0.4) ), title="Légende")
dev.off()
MyMap <- GetMap(center=center, zoom=11, markers = marker, destfile = "/home/pascal/MyTile.png", maptype="hybrid")
protection <- importShapefile("/home/pascal/protection84.shp")
tampon500 <- importShapefile("/home/pascal/tampon500.shp")
tampon2000 <- importShapefile("/home/pascal/tampon2000.shp")
tampon5000 <- importShapefile("/home/pascal/tampon5000.shp")
tampon10000 <- importShapefile("/home/pascal/tampon10000.shp")
png("/home/pascal/Bio Eco Forests.png",640,640)
plot.new()
PlotPolysOnStaticMap(MyMap, protection, lwd=.5, col = rgb(1,1,1,0.4), add = F)
PlotPolysOnStaticMap(MyMap, tampon10000, lwd=.5, col = rgb(1,0,0,0.1), add = T)
PlotPolysOnStaticMap(MyMap, tampon5000, lwd=.5, col = rgb(1,0,0,0.2), add = T)
PlotPolysOnStaticMap(MyMap, tampon2000, lwd=.5, col = rgb(1,0,0,0.3), add = T)
PlotPolysOnStaticMap(MyMap, tampon500, lwd=.5, col = rgb(1,0,0,0.4), add = T)
text(lat,lon,df$tiers[1])
legend("topright", c("Protection","Buffer 500m","Buffer 2000m","Buffer 5000m","Buffer 10000m"), fill = c(rgb(1,1,1,0.4),rgb(1,0,0,0.1),rgb(1,0,0,0.2),rgb(1,0,0,0.3),rgb(1,0,0,0.4) ), title="Légende")
dev.off()
source('~/tryton283/trytond/trytond/modules/rapport_environnemental/bef.R')
source('~/tryton283/trytond/trytond/modules/rapport_environnemental/bef.R')
View(dff)
dff[1:10,1:5]
dff[order(dff[,10]), 1:10,1:5]
dff[order(dff[,10])][1:10,1:5]
dff[order(dff[,10]),][1:10,1:5]
dff
str(dff)
dff[1:10,1:5]
dff10,1:5]
dff[10,1:5]
dff[,1:5]
dff[,5]
dff[,1:5]
dff[order(dff[,5]),1:5]
dff[order(dff[,5])][1:10,1:5]
dff[order(dff[,5]),1:10,1:5]
dff[order(dff[,5]),1:5]
source('~/tryton283/trytond/trytond/modules/rapport_environnemental/bef.R')
dff[1:10,order(dff[,5]),1:5]
dff[order(dff[1:10,5]),1:5]
source('~/tryton283/trytond/trytond/modules/rapport_environnemental/bef.R')
Data <- data.frame(df[2:3,c(7,12:14)])
Data.melt <- melt(Data)
p <- ggplot(data=Data.melt,aes(x=factor(nom),fill=variable))
g <- p + geom_bar(aes(weight=value)) + xlab(" ") + ylab(" ") + coord_flip() + theme_bw()+ scale_fill_brewer(palette = "PiYG")
print(g)
Data <- data.frame(df[2:13,c(7,12:14)])
Data.melt <- melt(Data)
p <- ggplot(data=Data.melt,aes(x=factor(nom),fill=variable))
g <- p + geom_bar(aes(weight=value)) + xlab(" ") + ylab(" ") + coord_flip() + theme_bw()+ scale_fill_brewer(palette = "PiYG")
print(g)
Data <- data.frame(df[2:11,c(7,12:14)])
Data.melt <- melt(Data)
p <- ggplot(data=Data.melt,aes(x=factor(nom),fill=variable))
g <- p + geom_bar(aes(weight=value)) + xlab(" ") + ylab(" ") + coord_flip() + theme_bw()+ scale_fill_brewer(palette = "PiYG")
print(g)
Data <- data.frame(df[order(df[2:11,9],c(7,12:14)])
Data <- data.frame(df[order(df[2:11,9]),c(7,12:14)])
Data.melt <- melt(Data)
p <- ggplot(data=Data.melt,aes(x=factor(nom),fill=variable))
g <- p + geom_bar(aes(weight=value)) + xlab(" ") + ylab(" ") + coord_flip() + theme_bw()+ scale_fill_brewer(palette = "PiYG")
print(g)
View(Data)
df
Data <- data.frame(df[order(df[2:11,9]),c(7,12:14)])
Data
View(Data)
Data.melt <- melt(Data)
View(Data.melt)
Data <- data.frame(df[order(df[2:12,9]),c(7,12:15)])
Data.melt <- melt(Data)
p <- ggplot(data=Data.melt,aes(x=factor(nom),fill=variable))
g <- p + geom_bar(aes(weight=value)) + xlab(" ") + ylab(" ") + coord_flip() + theme_bw()+ scale_fill_brewer(palette = "PiYG")
print(g)
Data <- data.frame(df[order(df[2:15,9]),c(7,12:15)])
Data.melt <- melt(Data)
p <- ggplot(data=Data.melt,aes(x=factor(nom),fill=variable))
g <- p + geom_bar(aes(weight=value)) + xlab(" ") + ylab(" ") + coord_flip() + theme_bw()+ scale_fill_brewer(palette = "PiYG")
print(g)
Data <- data.frame(df[order(df[,9]),c(7,12:15)])
Data.melt <- melt(Data)
p <- ggplot(data=Data.melt,aes(x=factor(nom),fill=variable))
g <- p + geom_bar(aes(weight=value)) + xlab(" ") + ylab(" ") + coord_flip() + theme_bw()+ scale_fill_brewer(palette = "PiYG")
print(g)
Data <- data.frame(df[order(df[1:15,9]),c(7,12:15)])
Data.melt <- melt(Data)
p <- ggplot(data=Data.melt,aes(x=factor(nom),fill=variable))
g <- p + geom_bar(aes(weight=value)) + xlab(" ") + ylab(" ") + coord_flip() + theme_bw()+ scale_fill_brewer(palette = "PiYG")
print(g)
Data
Data <- data.frame(df[order(df[,9]),c(7,12:15)])
Data.melt <- melt(Data)
p <- ggplot(data=Data.melt,aes(x=factor(nom),fill=variable))
g <- p + geom_bar(aes(weight=value)) + xlab(" ") + ylab(" ") + coord_flip() + theme_bw()+ scale_fill_brewer(palette = "PiYG")
print(g)
Data.melt
source('~/tryton283/trytond/trytond/modules/rapport_environnemental/bef.R')
g <- p + geom_bar(aes(weight=value)) + xlab(" ") + ylab(" ") + theme_bw()+ scale_fill_brewer(palette = "PiYG")
print(g)
coord_flip()
coord_flip()
p <- ggplot(data=Data.melt,aes(x=factor(nom),fill=variable))
g <- p + geom_bar(aes(weight=value)) + xlab(" ") + ylab(" ") + coord_flip() + theme_bw()+ scale_fill_brewer(palette = "PiYG")
print(g)
Data <- data.frame(df[order(df[1:5,9]),c(7,12:15)])
Data.melt <- melt(Data)
p <- ggplot(data=Data.melt,aes(x=factor(nom),fill=variable))
g <- p + geom_bar(aes(weight=value)) + xlab(" ") + ylab(" ") + coord_flip() + theme_bw()+ scale_fill_brewer(palette = "PiYG")
print(g)
Data <- data.frame(df[order(df[1:10,9]),c(7,12:15)])
Data.melt <- melt(Data)
p <- ggplot(data=Data.melt,aes(x=factor(nom),fill=variable))
g <- p + geom_bar(aes(weight=value)) + xlab(" ") + ylab(" ") + coord_flip() + theme_bw()+ scale_fill_brewer(palette = "PiYG")
print(g)
source('~/tryton283/trytond/trytond/modules/rapport_environnemental/bef.R')
source('~/tryton283/trytond/trytond/modules/rapport_environnemental/bef.R')
Data <- data.frame(df[order(df[1:5,9]),c(7,12:15)])
Data.melt <- melt(Data)
p <- ggplot(data=Data.melt,aes(x=factor(nom),fill=variable))
g <- p + geom_bar(aes(weight=value)) + xlab(" ") + ylab(" ") + coord_flip() + theme_bw()+ scale_fill_brewer(palette = "PiYG")
print(g)
Data <- data.frame(df[order(df[1:6,9]),c(7,12:15)])
Data.melt <- melt(Data)
p <- ggplot(data=Data.melt,aes(x=factor(nom),fill=variable))
g <- p + geom_bar(aes(weight=value)) + xlab(" ") + ylab(" ") + coord_flip() + theme_bw()+ scale_fill_brewer(palette = "PiYG")
print(g)
source('~/tryton283/trytond/trytond/modules/rapport_environnemental/bef.R')
f[order(df[1:6,9]),c(7,12:15)])
Data.melt <- melt(Data)
p <- ggplot(data=Data.melt,aes(x=factor(nom),fill=variable))
g <- p + geom_bar(aes(weight=value)) + xlab(" ") + ylab(" ") + coord_flip() + theme_bw()+ scale_fill_brewer(palette = "PiYG")
print(g)
source('~/tryton283/trytond/trytond/modules/rapport_environnemental/bef.R')
